# 存储管理：local 与 local-lvm 的爱恨情仇

刚安装完 PVE 的用户通常会很困惑：为什么我的硬盘被分成了 `local` 和 `local-lvm`？为什么 `local` 只有一点点空间？

## 官方设计的初衷

- **local (Directory)**：存放 ISO 镜像、备份文件、容器模板。它是一个普通的文件系统（EXT4/XFS）。
- **local-lvm (LVM-Thin)**：存放虚拟机的磁盘镜像（RAW 格式）。它支持快照、精简置备，性能极佳。

这种分离设计是为了**安全**。防止镜像文件占满整个系统盘导致 PVE 宿主机崩溃。

## 为什么要合并？

很多玩家只有一个小容量 SSD（比如 128G/256G），这种切分会导致空间分配非常僵硬。合并后，你可以自由地在同一个分区里放 ISO、放镜像、放备份。

### 合并的原理（PVE-Tools 实现逻辑）

1. **备份数据**：脚本会提醒你清空 `local-lvm` 上的所有虚拟机。
2. **删除 LVM-Thin 卷**：释放 `data` 卷的空间。
3. **扩容根分区**：将释放的空间全部给到 `/` 分区。
4. **修改存储配置**：更新 `/etc/pve/storage.cfg`，让 `local` 能够存储所有类型的文件。

## 关于硬盘休眠 (hdparm)

如果你的 PVE 挂载了机械硬盘 (HDD)，你可能希望它在闲时休眠以降低噪音和功耗。

**避坑指南**：
- **SAS 硬盘不支持 hdparm**：如果你用的是服务器拆机的 SAS 盘，`hdparm -S` 命令是无效的，甚至会报错。
- **系统盘无法休眠**：PVE 系统会频繁写入日志，如果 HDD 是系统盘，它几乎不可能休眠。
- **配置幂等**：脚本会将休眠配置写入 `/etc/hdparm.conf`，确保重启后依然有效。

## 总结
存储配置没有绝对的“正确方案”，只有“适合方案”。如果你有多块盘，建议保持分离；如果你只有一块小盘，合并可能是更好的选择。
