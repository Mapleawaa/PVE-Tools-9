# GitHub Actions Workflows ä½¿ç”¨æŒ‡å—

æœ¬é¡¹ç›®ä½¿ç”¨ GitHub Actions å®ç°è‡ªåŠ¨åŒ–çš„ CI/CD æµç¨‹ï¼ŒåŒ…æ‹¬ä»£ç æ£€æŸ¥ã€ç‰ˆæœ¬å‘å¸ƒå’Œæ›´æ–°æ—¥å¿—ç”Ÿæˆã€‚

## ğŸ“¦ Workflow åˆ—è¡¨

### 1. Syntax Check on Pushï¼ˆè¯­æ³•æ£€æŸ¥ï¼‰
**æ–‡ä»¶**: `.github/workflows/syntax-check.yml`

**è§¦å‘æ¡ä»¶**:
- Push åˆ° `main` æˆ– `beta` åˆ†æ”¯
- ä¿®æ”¹äº† `.sh` æ–‡ä»¶

**åŠŸèƒ½**:
- âœ… Bash è¯­æ³•æ£€æŸ¥ (`bash -n`)
- âœ… ShellCheck é™æ€åˆ†æ
- âœ… å±é™©å‘½ä»¤æ£€æµ‹
- âœ… è‡ªåŠ¨æ£€æŸ¥æ‰€æœ‰è„šæœ¬æ–‡ä»¶

**ç”¨é€”**: ç¡®ä¿æ¯æ¬¡ä»£ç æ¨é€éƒ½é€šè¿‡è¯­æ³•æ£€æŸ¥ï¼Œé˜²æ­¢å°†é”™è¯¯ä»£ç åˆå¹¶åˆ°ä¸»åˆ†æ”¯ã€‚

---

### 2. PR Validationï¼ˆPR éªŒè¯ï¼‰
**æ–‡ä»¶**: `.github/workflows/pr-validation.yml`

**è§¦å‘æ¡ä»¶**:
- åˆ›å»ºæˆ–æ›´æ–° Pull Request åˆ° `main` æˆ– `beta` åˆ†æ”¯

**åŠŸèƒ½**:
- âœ… ShellCheck ä»£ç è´¨é‡æ£€æŸ¥
- âœ… Bash è¯­æ³•éªŒè¯
- âœ… ç‰ˆæœ¬å·ä¸€è‡´æ€§æ£€æŸ¥
- âœ… å®‰å…¨æ‰«æï¼ˆæ£€æµ‹ eval/source ç­‰å±é™©å‘½ä»¤ï¼‰

**ç”¨é€”**: åœ¨åˆå¹¶ PR å‰è‡ªåŠ¨éªŒè¯ä»£ç è´¨é‡å’Œå®‰å…¨æ€§ã€‚

---

### 3. Release to Mainï¼ˆæ­£å¼ç‰ˆæœ¬å‘å¸ƒï¼‰
**æ–‡ä»¶**: `.github/workflows/release.yml`

**è§¦å‘æ¡ä»¶**:
- æ¨é€ç¬¦åˆä»¥ä¸‹æ ¼å¼çš„ Tag:
  - `v[0-9]+.[0-9]+.[0-9]+` (ä¾‹å¦‚: `v4.2.0`)
  - `v[0-9]+.[0-9]+.[0-9]+-stable` (ä¾‹å¦‚: `v4.2.0-stable`)

**åŠŸèƒ½**:
- ğŸ” è¯­æ³•æ£€æŸ¥ï¼ˆBash + ShellCheckï¼‰
- ğŸ“ è‡ªåŠ¨æ›´æ–° VERSION æ–‡ä»¶å’Œè„šæœ¬ç‰ˆæœ¬å·
- ğŸ“‹ ç”Ÿæˆæ ¼å¼åŒ–çš„æ›´æ–°æ—¥å¿—ï¼ˆChangelogï¼‰
  - âœ¨ æ–°å¢åŠŸèƒ½
  - ğŸ› é”™è¯¯ä¿®å¤
  - âš¡ æ€§èƒ½ä¼˜åŒ–
  - ğŸ“š æ–‡æ¡£æ›´æ–°
  - ğŸ“Š ç‰ˆæœ¬ç»Ÿè®¡
  - ğŸ‘¥ è´¡çŒ®è€…åˆ—è¡¨
- ğŸš€ åˆ›å»º GitHub Release
- ğŸ“¦ ä¸Šä¼ è„šæœ¬æ–‡ä»¶åˆ° Release

**ä½¿ç”¨æ–¹æ³•**:
```bash
# 1. ç¡®ä¿æœ¬åœ°ä»£ç å·²æäº¤
git add .
git commit -m "feat: æ·»åŠ æ–°åŠŸèƒ½"

# 2. åˆ›å»ºå¹¶æ¨é€ Tag
git tag v4.3.0
git push origin v4.3.0

# 3. GitHub Actions è‡ªåŠ¨æ‰§è¡Œå‘å¸ƒæµç¨‹
# 4. æ£€æŸ¥ Release é¡µé¢æŸ¥çœ‹å‘å¸ƒç»“æœ
```

**Changelog æ ¼å¼ç¤ºä¾‹**:
```markdown
## ğŸ“‹ æ›´æ–°æ—¥å¿—

### âœ¨ æ–°å¢åŠŸèƒ½
- æ·»åŠ å¤šå— NVMe ç¡¬ç›˜è¯†åˆ«åŠŸèƒ½ (marecyra)
- ä¼˜åŒ–æ¸©åº¦ç›‘æ§æ˜¾ç¤º (contributor1)

### ğŸ› é”™è¯¯ä¿®å¤
- ä¿®å¤ SATA ç¡¬ç›˜æ¸©åº¦æ˜¾ç¤ºé—®é¢˜ (marecyra)
- ä¿®å¤ç‰ˆæœ¬æ£€æŸ¥é€»è¾‘ (contributor2)

### âš¡ æ€§èƒ½ä¼˜åŒ–
- ä¼˜åŒ–è„šæœ¬å¯åŠ¨é€Ÿåº¦ (marecyra)

### ğŸ“Š ç‰ˆæœ¬ç»Ÿè®¡
- æäº¤æ•°é‡: 15
- è´¡çŒ®è€…æ•°: 3

### ğŸ‘¥ è´¡çŒ®è€…
- @marecyra
- @contributor1
- @contributor2
```

---

### 4. Release to Betaï¼ˆæµ‹è¯•ç‰ˆæœ¬å‘å¸ƒï¼‰
**æ–‡ä»¶**: `.github/workflows/beta-release.yml`

**è§¦å‘æ¡ä»¶**:
- æ¨é€ç¬¦åˆä»¥ä¸‹æ ¼å¼çš„ Tag:
  - `v[0-9]+.[0-9]+.[0-9]+-beta*` (ä¾‹å¦‚: `v4.3.0-beta1`)
  - `v[0-9]+.[0-9]+.[0-9]+-alpha*` (ä¾‹å¦‚: `v4.3.0-alpha1`)

**åŠŸèƒ½**:
- ğŸ” è¯­æ³•æ£€æŸ¥ï¼ˆæ›´å®½æ¾çš„è§„åˆ™ï¼‰
- ğŸ“ è‡ªåŠ¨æ›´æ–° VERSION æ–‡ä»¶
- ğŸ“‹ ç”Ÿæˆ Beta ç‰ˆæœ¬æ›´æ–°æ—¥å¿—
  - åŒ…å«å®éªŒæ€§åŠŸèƒ½æ ‡æ³¨
- ğŸš§ åˆ›å»º Pre-release
- ğŸ“¦ ä¸Šä¼ è„šæœ¬æ–‡ä»¶

**ä½¿ç”¨æ–¹æ³•**:
```bash
# å‘å¸ƒ Beta ç‰ˆæœ¬
git tag v4.3.0-beta1
git push origin v4.3.0-beta1

# å‘å¸ƒ Alpha ç‰ˆæœ¬
git tag v4.3.0-alpha1
git push origin v4.3.0-alpha1
```

---

## ğŸ¯ æœ€ä½³å®è·µ

### Commit Message è§„èŒƒ

ä¸ºäº†ç”Ÿæˆç¾è§‚çš„ Changelogï¼Œè¯·éµå¾ª Conventional Commits è§„èŒƒï¼š

```bash
# æ–°å¢åŠŸèƒ½
git commit -m "feat: æ·»åŠ æ¸©åº¦ç›‘æ§åŠŸèƒ½"
git commit -m "feature(nvme): æ”¯æŒå¤šå— NVMe ç¡¬ç›˜"

# é”™è¯¯ä¿®å¤
git commit -m "fix: ä¿®å¤è¯­æ³•é”™è¯¯"
git commit -m "bugfix(kernel): ä¿®å¤å†…æ ¸ç‰ˆæœ¬æ£€æµ‹"

# æ€§èƒ½ä¼˜åŒ–
git commit -m "perf: ä¼˜åŒ–è„šæœ¬å¯åŠ¨é€Ÿåº¦"

# æ–‡æ¡£æ›´æ–°
git commit -m "docs: æ›´æ–° README"

# ä»£ç é‡æ„
git commit -m "refactor: é‡æ„æ—¥å¿—ç³»ç»Ÿ"

# æµ‹è¯•
git commit -m "test: æ·»åŠ å•å…ƒæµ‹è¯•"

# æ„å»º/CI
git commit -m "build: æ›´æ–° workflow é…ç½®"
git commit -m "ci: æ·»åŠ è¯­æ³•æ£€æŸ¥"

# å…¶ä»–ç»´æŠ¤
git commit -m "chore: æ›´æ–°ç‰ˆæœ¬å·"
git commit -m "style: æ ¼å¼åŒ–ä»£ç "
```

### ç‰ˆæœ¬å‘å¸ƒæµç¨‹

#### æ­£å¼ç‰ˆæœ¬å‘å¸ƒ
```bash
# 1. åˆ‡æ¢åˆ° main åˆ†æ”¯
git checkout main
git pull origin main

# 2. ç¡®ä¿æ‰€æœ‰æ”¹åŠ¨å·²æäº¤
git status

# 3. åˆ›å»ºç‰ˆæœ¬ Tagï¼ˆéµå¾ª SemVer è§„èŒƒï¼‰
# ä¸»ç‰ˆæœ¬.æ¬¡ç‰ˆæœ¬.ä¿®è®¢ç‰ˆæœ¬
git tag v4.3.0

# 4. æ¨é€ Tag è§¦å‘å‘å¸ƒ
git push origin v4.3.0

# 5. ç­‰å¾… GitHub Actions å®Œæˆï¼ˆçº¦ 2-3 åˆ†é’Ÿï¼‰
# 6. æ£€æŸ¥ Release é¡µé¢
```

#### Beta ç‰ˆæœ¬å‘å¸ƒ
```bash
# 1. åˆ‡æ¢åˆ° beta åˆ†æ”¯
git checkout beta

# 2. åˆ›å»º Beta Tag
git tag v4.3.0-beta1

# 3. æ¨é€è§¦å‘å‘å¸ƒ
git push origin v4.3.0-beta1
```

---

## ğŸ”§ Workflow é…ç½®è¯´æ˜

### ShellCheck å¿½ç•¥è§„åˆ™

ä»¥ä¸‹è§„åˆ™åœ¨é¡¹ç›®ä¸­è¢«å¿½ç•¥ï¼ˆæ ¹æ®å®é™…éœ€æ±‚è°ƒæ•´ï¼‰:
- `SC2086`: åŒå¼•å·å¼•ç”¨é˜²æ­¢åˆ†è¯
- `SC2181`: ç›´æ¥æ£€æŸ¥å‘½ä»¤è€Œé $?
- `SC2162`: read å‘½ä»¤ä½¿ç”¨ -r å‚æ•°

**ä¿®æ”¹ä½ç½®**:
- `syntax-check.yml`: ç¬¬ 49 è¡Œ
- `release.yml`: ç¬¬ 36 è¡Œ
- `beta-release.yml`: ç¬¬ 36 è¡Œ

### è‡ªå®šä¹‰ Changelog æ ¼å¼

å¦‚éœ€ä¿®æ”¹ Changelog æ ¼å¼ï¼Œç¼–è¾‘ä»¥ä¸‹æ–‡ä»¶ï¼š
- `release.yml`: ç¬¬ 76-171 è¡Œ
- `beta-release.yml`: ç¬¬ 75-150 è¡Œ

---

## ğŸ“Š ç›‘æ§å’Œè°ƒè¯•

### æŸ¥çœ‹ Workflow è¿è¡ŒçŠ¶æ€
1. è®¿é—®ä»“åº“çš„ "Actions" æ ‡ç­¾é¡µ
2. é€‰æ‹©å¯¹åº”çš„ Workflow
3. æŸ¥çœ‹è¿è¡Œæ—¥å¿—å’Œç»“æœ

### å¸¸è§é—®é¢˜

**Q: ä¸ºä»€ä¹ˆ Release æ²¡æœ‰è‡ªåŠ¨åˆ›å»ºï¼Ÿ**
A: æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹ï¼š
- Tag æ ¼å¼æ˜¯å¦æ­£ç¡®ï¼ˆå¿…é¡»ä»¥ `v` å¼€å¤´ï¼‰
- GitHub Actions æ˜¯å¦å¯ç”¨
- GITHUB_TOKEN æƒé™æ˜¯å¦è¶³å¤Ÿ

**Q: Changelog ä¸ºä»€ä¹ˆæ˜¯ç©ºçš„ï¼Ÿ**
A: å¯èƒ½åŸå› ï¼š
- è¿™æ˜¯ç¬¬ä¸€ä¸ª Tagï¼ˆæ²¡æœ‰å‰ä¸€ä¸ªç‰ˆæœ¬æ¯”è¾ƒï¼‰
- Commit message ä¸ç¬¦åˆ Conventional Commits è§„èŒƒ

**Q: è¯­æ³•æ£€æŸ¥å¤±è´¥å¦‚ä½•å¤„ç†ï¼Ÿ**
A:
1. æœ¬åœ°è¿è¡Œ `bash -n PVE-Tools.sh` æ£€æŸ¥è¯­æ³•
2. å®‰è£… ShellCheck: `brew install shellcheck`
3. è¿è¡Œ `shellcheck PVE-Tools.sh` æŸ¥çœ‹é—®é¢˜

---

## ğŸš€ æœªæ¥æ”¹è¿›

- [ ] æ·»åŠ è‡ªåŠ¨åŒ–æµ‹è¯•
- [ ] é›†æˆä»£ç è¦†ç›–ç‡æ£€æŸ¥
- [ ] æ”¯æŒå¤šè¯­è¨€ Changelog
- [ ] è‡ªåŠ¨ç”Ÿæˆ Release Notes è‰ç¨¿
- [ ] é›†æˆ Dependabot ä¾èµ–æ›´æ–°

---

## ğŸ“ è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»ï¼š
- [æäº¤ Issue](https://github.com/Mapleawaa/PVE-Tools-9/issues/new)
- [å‘èµ· Discussion](https://github.com/Mapleawaa/PVE-Tools-9/discussions)
